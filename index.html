<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ƒê·∫°i Ka - Qu·∫£n l√Ω nh√¢n vi√™n</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      margin:0;
      background: #f0f2f5;
      color:#333;
    }

    /* Sidebar menu */
    .menu {
      position:fixed; top:0; left:0; width:220px; height:100vh;
      background:#0d6efd; color:#fff; padding:20px;
      box-shadow: 2px 0 8px rgba(0,0,0,0.15);
    }
    .menu h3 {
      text-align:center; margin-bottom:20px; font-size:20px;
      border-bottom:1px solid rgba(255,255,255,0.3); padding-bottom:10px;
    }
    .menu button {
      display:block; width:100%; margin:10px 0; padding:12px;
      border:none; border-radius:8px; background:#fff; color:#0d6efd;
      font-weight:bold; cursor:pointer; transition:0.3s;
    }
    .menu button:hover { background:#e9ecef; transform:scale(1.03); }

    /* N·ªôi dung */
    #roomContent {
      margin-left:240px; padding:30px;
    }
    #roomContent h3 {
      font-size:22px; color:#0d6efd; margin-bottom:20px;
    }

    /* B·∫£ng nh√¢n vi√™n */
    table {
      border-collapse: collapse; width:100%; background:#fff;
      border-radius:12px; overflow:hidden;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
    }
    th, td {
      padding:12px 15px; text-align:left;
    }
    th {
      background:#0d6efd; color:#fff; font-weight:600;
    }
    tr:nth-child(even) { background:#f9f9f9; }
    tr:hover { background:#eef4ff; }

    /* N√∫t ch·ªçn file v√† l∆∞u */
    .actions {
      margin-bottom:20px;
    }
    .actions input[type=file] {
      margin-right:10px;
    }
    .actions button {
      padding:10px 16px; border:none; border-radius:6px;
      background:#198754; color:#fff; font-weight:bold;
      cursor:pointer; transition:0.3s;
    }
    .actions button:hover { background:#157347; }
  </style>
</head>
<body>

  <!-- Menu ch√≠nh -->
  <div class="menu" id="menuBox">
    <h3>Menu ch√≠nh</h3>
    <button onclick="showRoom('BHTN')">Ph√≤ng BHTN</button>
    <button onclick="showRoom('VL')">Ph√≤ng VL</button>
  </div>

  <!-- N·ªôi dung -->
  <div id="roomContent">
    <h3></h3>
  </div>

  <script>
    let employees = { BHTN: [], VL: [] };

    function showRoom(room) {
      const data = employees[room] || [];
      let html = `<h3>Danh s√°ch nh√¢n vi√™n ph√≤ng ${room}</h3>`;
      html += `<div class="actions">
                 <input type="file" accept=".xlsx,.xls" onchange="handleFile(event, '${room}')"/>
                 <button onclick="saveFile('${room}')">üíæ L∆∞u file Excel</button>
               </div>`;
      html += `<table><tr>
                 <th>H·ªç t√™n</th><th>Ch·ª©c v·ª•</th><th>ƒê∆°n v·ªã c√¥ng t√°c</th><th>Ng·∫°ch b·∫≠c</th>
               </tr>`;
      data.forEach((emp, index) => {
        html += `<tr>
                   <td contenteditable="true" onblur="updateEmployee('${room}', ${index}, 'name', this.innerText)">${emp.name}</td>
                   <td contenteditable="true" onblur="updateEmployee('${room}', ${index}, 'position', this.innerText)">${emp.position}</td>
                   <td contenteditable="true" onblur="updateEmployee('${room}', ${index}, 'unit', this.innerText)">${emp.unit || ""}</td>
                   <td contenteditable="true" onblur="updateEmployee('${room}', ${index}, 'rank', this.innerText)">${emp.rank || ""}</td>
                 </tr>`;
      });
      html += `</table>`;
      document.getElementById('roomContent').innerHTML = html;
    }

    function updateEmployee(room, index, field, value) {
      employees[room][index][field] = value;
      localStorage.setItem("employeesData", JSON.stringify(employees));
    }

    function handleFile(event, room) {
      const file = event.target.files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, {type: 'array'});
        const sheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[sheetName];
        const json = XLSX.utils.sheet_to_json(worksheet);

        employees[room] = [];
        json.forEach(row => {
          const keys = Object.keys(row);
          employees[room].push({
            name: row["H·ªç t√™n"] || row[keys[0]],
            position: row["Ch·ª©c v·ª•"] || row[keys[1]],
            unit: row["ƒê∆°n v·ªã c√¥ng t√°c"] || row[keys[2]],
            rank: row["Ng·∫°ch b·∫≠c"] || row[keys[3]]
          });
        });

        localStorage.setItem("employeesData", JSON.stringify(employees));
        showRoom(room);
      };
      reader.readAsArrayBuffer(file);
    }

    function saveFile(room) {
      const data = employees[room] || [];
      if(data.length === 0) {
        alert("Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ l∆∞u!");
        return;
      }
      const worksheet = XLSX.utils.json_to_sheet(data.map(emp => ({
        "H·ªç t√™n": emp.name,
        "Ch·ª©c v·ª•": emp.position,
        "ƒê∆°n v·ªã c√¥ng t√°c": emp.unit,
        "Ng·∫°ch b·∫≠c": emp.rank
      })));
      const workbook = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(workbook, worksheet, room);
      XLSX.writeFile(workbook, `NhanVien_${room}.xlsx`);

      localStorage.setItem("employeesData", JSON.stringify(employees));
      alert("D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c l∆∞u v√†o LocalStorage!");
    }

    window.onload = function() {
      const saved = localStorage.getItem("employeesData");
      if(saved) {
        employees = JSON.parse(saved);
      }
    }
  </script>

</body>
</html>
